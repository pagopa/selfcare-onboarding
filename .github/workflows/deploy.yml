name: Auto Deploy

# Controls when the workflow will run
on:
  pull_request:
    branches:
      - main
    types: [ closed ]


  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
    if: ${{ github.event.pull_request.merged }}
    name: Call Azure Build Pipeline
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - uses: actions/checkout@v4
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: 17

    - name: Build project with Maven
      run: mvn -B package --file onboarding-functions/pom.xml

    # - name: Deploy azure
    #  run: mvn -B quarkus:deploy --file onboarding-functions/pom.xml
    #  env:
    #    AZURE_SUBSCRIPTION_ID: ${{ secrets.SUBSCRIPTION_ID }}
    #    AZURE_RESOURCE_GROUP: ${{ secrets.FUNCTIONS_RESOURCE_GROUP }}
    #    AZURE_APP_REGION: ${{ secrets.APP_REGION }}
    #    AZURE_APP_INSIGHTS_KEY: ${{ secrets.APP_INSIGHTS_KEY }}


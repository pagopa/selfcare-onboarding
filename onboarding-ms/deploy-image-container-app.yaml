properties:
  managedEnvironmentId: /subscriptions/$SUBSCRIPTION_ID$/resourceGroups/$RESOURCE_GROUP$/providers/Microsoft.App/managedEnvironments/$CONTAINER_APP_ENV$
  configuration:
    secrets:
      - name: jwt-public-key
        value: $JWT_PUBLIC_KEY$
      - name: mongo-connection-uri
        value: $MONGODB_CONNECTION_URI$
      - name: user-registry-api-key
        value: $USER_REGISTRY_API_KEY$
      - name: onboarding-functions-api-key
        value: $ONBOARDING_FUNCTIONS_API_KEY$
    ingress:
      external: true
      allowInsecure: true
      targetPort: 8080
      transport: Auto
  template:
    containers:
      - image: ghcr.io/pagopa/selfcare-onboarding-ms:latest
        name: selfcare-onboarding-ms
        env:
          - name: JWT_TOKEN_PUBLIC_KEY
            secretRef: jwt-public-key
          - name: MONGODB_CONNECTION_URI
            secretRef: mongo-connection-uri
          - name: USER_REGISTRY_API_KEY
            secretRef: user-registry-api-key
          - name: USER_REGISTRY_URL
            value: $USER_REGISTRY_URL$
          - name: ONBOARDING_FUNCTIONS_API_KEY
            secretRef: onboarding-functions-api-key
          - name: ONBOARDING_FUNCTIONS_URL
            value: $ONBOARDING_FUNCTIONS_URL$
          - name: ONBOARDING_ALLOWED_INSTITUTIONS_PRODUCTS
            value: $ONBOARDING_ALLOWED_INSTITUTIONS_PRODUCTS$
    scale:
      minReplicas: 1
      maxReplicas: 5